<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="description" content="Model of change and versioning">
<meta name="keywords" content="EHR, conformance">
<title>S2 Change Control Model</title>
<link rel="stylesheet" href="https://platform.s2health.org/css/s2.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_s2_change_control_model">S2 Change Control Model</a>
<ul class="sectlevel1">
<li><a href="#_revision_history">Revision History</a></li>
<li><a href="#_acknowledgements">Acknowledgements</a>
<ul class="sectlevel2">
<li><a href="#_prior_art">Prior Art</a></li>
<li><a href="#_trademarks">Trademarks</a></li>
</ul>
</li>
<li><a href="#_preface">1. Preface</a>
<ul class="sectlevel2">
<li><a href="#_purpose">1.1. Purpose</a></li>
<li><a href="#_related_documents">1.2. Related Documents</a></li>
<li><a href="#_status">1.3. Status</a></li>
<li><a href="#_prior_art_2">1.4. Prior Art</a></li>
<li><a href="#_feedback">1.5. Feedback</a></li>
<li><a href="#_conformance">1.6. Conformance</a></li>
</ul>
</li>
<li><a href="#_overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_basic_semantics">2.1. Basic Semantics</a>
<ul class="sectlevel3">
<li><a href="#_typing">2.1.1. Typing</a></li>
<li><a href="#_versioned_objects">2.1.2. Versioned Objects</a></li>
<li><a href="#_version_and_its_subtypes">2.1.3. Version and its Subtypes</a></li>
<li><a href="#_the_virtual_version_tree">2.1.4. The 'Virtual Version Tree'</a></li>
<li><a href="#_contributions">2.1.5. Contributions</a></li>
<li><a href="#_committal_and_audits">2.1.6. Committal and Audits</a></li>
<li><a href="#_digital_signature">2.1.7. Digital Signature</a></li>
<li><a href="#_attestation">2.1.8. Attestation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_versioning">3. Versioning</a>
<ul class="sectlevel2">
<li><a href="#_version_lifecycle">3.1. Version Lifecycle</a>
<ul class="sectlevel3">
<li><a href="#_incomplete_content">3.1.1. Incomplete Content</a></li>
<li><a href="#_abandoned_and_inactive_states">3.1.2. Abandoned and Inactive States</a></li>
</ul>
</li>
<li><a href="#_logical_deletion">3.2. Logical Deletion</a></li>
<li><a href="#_version_identification">3.3. Version Identification</a>
<ul class="sectlevel3">
<li><a href="#_local_versioning">3.3.1. Local Versioning</a></li>
<li><a href="#_distributed_versioning">3.3.2. Distributed Versioning</a></li>
</ul>
</li>
<li><a href="#_class_descriptions">3.4. Class Descriptions</a>
<ul class="sectlevel3">
<li><a href="#_versioned_object_class">3.4.1. Versioned_object Class</a></li>
<li><a href="#_version_class">3.4.2. Version Class</a></li>
<li><a href="#_original_version_class">3.4.3. Original_version Class</a></li>
<li><a href="#_imported_version_class">3.4.4. Imported_version Class</a></li>
<li><a href="#_contribution_class">3.4.5. Contribution Class</a></li>
<li><a href="#_audit_details_class">3.4.6. Audit_details Class</a></li>
<li><a href="#_attestation_class">3.4.7. Attestation Class</a></li>
<li><a href="#_audit_change_type_enumeration">3.4.8. Audit_change_type Enumeration</a></li>
<li><a href="#_attestation_reason_enumeration">3.4.9. Attestation_reason Enumeration</a></li>
<li><a href="#_version_lifecycle_state_enumeration">3.4.10. Version_lifecycle_state Enumeration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_semantics_in_distributed_systems">4. Semantics in Distributed Systems</a>
<ul class="sectlevel2">
<li><a href="#_copying">4.1. Copying</a>
<ul class="sectlevel3">
<li><a href="#_the_copy_operation">4.1.1. The Copy Operation</a></li>
<li><a href="#_subsequent_local_modifications">4.1.2. Subsequent Local Modifications</a></li>
</ul>
</li>
<li><a href="#_version_merging">4.2. Version Merging</a></li>
<li><a href="#_disjoint_merging">4.3. Disjoint Merging</a></li>
<li><a href="#_moving_version_containers">4.4. Moving Version Containers</a></li>
</ul>
</li>
<li><a href="#_references">References</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="http://s2health.org/resources/logos/s2logo.svg" alt="S2 logo">
</div>
</div>
</div>
</div>
<h1 id="_s2_change_control_model" class="sect0"><a class="anchor" href="#_s2_change_control_model"></a>S2 Change Control Model</h1>
<div class="openblock partintro">
<div class="content">
<table class="tableblock frame-all grid-all fit-content spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2"><strong>Issuer</strong>: <a href="http://www.s2health.org" target="_blank" rel="noopener">S2 Health</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Release</strong>: BASE latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Status</strong>: STABLE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Revision</strong>: <a href="#latest_issue">[latest_issue]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Date</strong>: <a href="#latest_issue_date">[latest_issue_date]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Keywords</strong>: EHR, conformance</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">&#169; 2023 - 2025 S2 Health</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><a href="http://www.s2health.org" target="_blank" rel="noopener">S2 Health</a> is an independent, non-profit foundation.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Licence</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="https://specifications.openehr.org/images/cc-by-nd-88x31.png" alt="image"></span> Creative Commons Attribution-NoDerivs 4.0 Unported. <a href="https://creativecommons.org/licenses/by-nd/4.0/" class="bare">https://creativecommons.org/licenses/by-nd/4.0/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Support</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issues: <a href="https://platform.s2health.org/components/BASE/open_issues" target="_blank" rel="noopener">Report an Issue</a><br>
 Web: <a href="https://platform.s2health.org" target="_blank" rel="noopener">https://platform.s2health.org</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_revision_history"><a class="anchor" href="#_revision_history"></a>Revision History</h2>
<div class="sectionbody">
<details>
<summary class="title">[click here]</summary>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 54.5454%;">
<col style="width: 18.1818%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Issue</th>
<th class="tableblock halign-left valign-top">Details</th>
<th class="tableblock halign-left valign-top">Raiser</th>
<th class="tableblock halign-left valign-top">Completed</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>BASE Release 0.9.0</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>BASE Release 0.8.7</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>BASE Release 0.8.6</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>BASE Release 0.8.5</strong></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="latest_issue"></a>0.8.5</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://platform.s2health.org/tickets/S2BASE-49" target="_blank" rel="noopener">S2BASE-49</a>. Replace <code>Party_proxy</code> and related classes with <code>Entity_ref_node</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">J Coyle,<br>
N Davis,<br>
S Huff,<br>
T Beale</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="latest_issue_date"></a>27 Sep 2024</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>0.1.0</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial Writing: based on the <a href="https://specifications.openehr.org/releases/RM/latest/common.html#_change_control_package" target="_blank" rel="noopener">openEHR Common IM</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>10 Apr 2023</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</details>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a>Acknowledgements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_prior_art"><a class="anchor" href="#_prior_art"></a>Prior Art</h3>
<div class="paragraph">
<p>This specification is largely derived from the Change Control section of the <a href="https://specifications.openehr.org/releases/RM/latest/common.html#_change_control_package" target="_blank" rel="noopener">openEHR Common IM</a> specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="_trademarks"><a class="anchor" href="#_trademarks"></a>Trademarks</h3>
<div class="ulist">
<ul>
<li>
<p>'openEHR' is a registered trademark of the openEHR Foundation</p>
</li>
<li>
<p>'Graphite Health' is a registered trademark of Graphite Health</p>
</li>
<li>
<p>'Java' is a registered trademark of Oracle Corporation</p>
</li>
<li>
<p>'Microsoft' and '.Net' are registered trademarks of the Microsoft Corporation</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preface"><a class="anchor" href="#_preface"></a>1. Preface</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_purpose"><a class="anchor" href="#_purpose"></a>1.1. Purpose</h3>
<div class="paragraph">
<p>This document describes the architecture of the S2 Change Control Model, which defines versioning of the S2 EHR.</p>
</div>
<div class="paragraph">
<p>The intended audience includes implementers and health IT standards experts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_related_documents"><a class="anchor" href="#_related_documents"></a>1.2. Related Documents</h3>
<div class="paragraph">
<p>Prerequisite documents for reading this document include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://platform.s2health.org/releases/RM/latest/architecture_overview.html" target="_blank" rel="noopener">S2 Architecture Overview</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Related documents include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://specifications.openehr.org/releases/RM/latest/common.html#_change_control_package" target="_blank" rel="noopener">openEHR Change Control package</a>;</p>
</li>
<li>
<p>The <a href="https://platform.s2health.org/releases/BASE/latest/model_support.html" target="_blank" rel="noopener">S2 Base Types</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_status"><a class="anchor" href="#_status"></a>1.3. Status</h3>
<div class="paragraph">
<p>This specification is in the STABLE state. The development version of this document can be found at <a href="https://platform.s2health.org/releases/BASE/latest/change_control.html" target="_blank" rel="noopener">https://platform.s2health.org/releases/BASE/latest/change_control.html</a>.</p>
</div>
<div class="paragraph">
<p>Known omissions or questions are indicated in the text with a 'to be determined' paragraph, as follows:</p>
</div>
<div class="paragraph tbd">
<p><strong>TBD</strong>: (example To Be Determined paragraph)</p>
</div>
</div>
<div class="sect2">
<h3 id="_prior_art_2"><a class="anchor" href="#_prior_art_2"></a>1.4. Prior Art</h3>
<div class="paragraph">
<p>This specification was derived from the Change Control section of the <a href="https://specifications.openehr.org/releases/RM/latest/common.html#_change_control_package" target="_blank" rel="noopener">openEHR RM Common IM specification</a>. It has been slightly modified as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>class names are converted to 'mixed snake case';</p>
</li>
<li>
<p>the <code>Audit_details</code> class is slightly modified;</p>
</li>
<li>
<p><code>Version.lifecycle_state</code> is represented by an enumeration rather than a coded text.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are no changes to the openEHR versioning semantics.</p>
</div>
</div>
<div class="sect2">
<h3 id="_feedback"><a class="anchor" href="#_feedback"></a>1.5. Feedback</h3>
<div class="paragraph">
<p>Feedback may be provided on the <a href="https://discourse.s2health.org" target="_blank" rel="noopener">S2 specifications forum</a>.</p>
</div>
<div class="paragraph">
<p>Issues may be raised on the <a href="https://platform.s2health.org/components/BASE/open_issues" target="_blank" rel="noopener">specifications Problem Report tracker</a>.</p>
</div>
<div class="paragraph">
<p>To see changes made due to previously reported issues, see the <a href="https://platform.s2health.org/components/BASE/history" target="_blank" rel="noopener">BASE component Change Request tracker</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conformance"><a class="anchor" href="#_conformance"></a>1.6. Conformance</h3>
<div class="paragraph">
<p>Conformance of a data or software artifact to an S2 specification is determined by a formal test of that artifact against the relevant S2 Implementation Technology Specification(s) (ITSs), such as a JSON-schema or OpenAPI specification. Since ITSs are formal derivations from underlying models, ITS conformance indicates model conformance.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>2. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As described in the Architecture Overview document, formal version control and change management are used in S2 to support the construction of EHR and other repositories requiring the properties of consistency, indelibility, traceability and distributed sharing. The <code>change_control</code> package supplies the formal specification of these features in S2.</p>
</div>
<div class="paragraph">
<p><a href="#change_control_package">Figure 1</a> illustrates the S2 model of a Versioned object, and its constituent Versions. In this model, an instance of the class <code>Versioned_object&lt;T&gt;</code> provides the versioning facilities for one versioned item and is often referred to as a 'version container'. Although any kind of data can be versioned according to the model presented here, the use of versioning in S2 is limited to 'top-level structures', such as EHR Compositions and Party objects in a demographic system.</p>
</div>
<div id="change_control_package" class="imageblock text-center text-center">
<div class="content">
<img src="UML/diagrams/BASE-change_control.svg" alt="BASE change control">
</div>
<div class="title">Figure 1. <code>common.change_control</code> Package</div>
</div>
<div class="paragraph">
<p><a href="#version_control_structures">Figure 2</a> illustrates a single <code>Versioned_object</code> containing a number of <code>VERSIONs</code>. Although the figure implies physical containment of Versions by a Versioned object, this is only one possible implementation. Other implementations (e.g. using orthodox relational structures) might use references, separate compressed copies, or any other mechanism.</p>
</div>
<div id="version_control_structures" class="imageblock text-center text-center">
<div class="content">
<img src="change_control/diagrams/version_control_structures.png" alt="version control structures" width="80%">
</div>
<div class="title">Figure 2. Version control structures</div>
</div>
<div class="sect2">
<h3 id="_basic_semantics"><a class="anchor" href="#_basic_semantics"></a>2.1. Basic Semantics</h3>
<div class="sect3">
<h4 id="_typing"><a class="anchor" href="#_typing"></a>2.1.1. Typing</h4>
<div class="paragraph">
<p>The classes <code>Versioned_object&lt;T&gt;</code>, <code>Version&lt;T&gt;</code>, <code>Original_version&lt;T&gt;</code> and <code>Imported_version&lt;T&gt;</code> are generic classes, with the generic parameter type T being the type of the data. This ensures that all versions in a given <code>Versioned_object</code> are of the same type, such as <code>Composition</code>, <code>FOLDER</code>, or <code>PARTY</code> and that the version container itself is properly typed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_versioned_objects"><a class="anchor" href="#_versioned_objects"></a>2.1.2. Versioned Objects</h4>
<div class="paragraph">
<p>Each <code>Versioned_object</code> has a unique identifier recorded in the <code><em>uid</em></code> attribute (a <code>HIER_OBJECT_ID</code> typically containing a GUID), and a reference to the owning object (e.g. the owning EHR) in the <code><em>owner_id</em></code> attribute (this is typically also a GUID). The latter helps ensure that in storage systems, Versioned objects are always correctly allocated to their enclosing repository, such as an EHR.</p>
</div>
<div class="paragraph">
<p>The data in a <code>Versioned_object</code> are in the form of a collection of instances of the two <code>Version&lt;T&gt;</code> subtypes, and are available only via the functional interface of <code>Versioned_object</code>. How the representation of this collection is implemented inside the <code>Versioned_object</code> is not defined by this specification, only the form of any given version is. Implementations of <code>Versioned_object</code> might range from the simple (all versions stored as full copies in a list) to a sophisticated compressed versioning approach as used in software file version control and some object databases. (The persistent data format of implementations of <code>Versioned_object</code> developed by different organisations will in general be incompatible. For purposes of sharing, an interoperable expression of <code>Versioned_object</code> is defined by the <code>X_Versioned_object</code> class in the EHR Extract IM.)</p>
</div>
</div>
<div class="sect3">
<h4 id="_version_and_its_subtypes"><a class="anchor" href="#_version_and_its_subtypes"></a>2.1.3. Version and its Subtypes</h4>
<div class="paragraph">
<p>Within a Versioned object, each version is an instance of a subtype of the class <code>Version&lt;T&gt;</code>. The abstract <code>Version</code> class defines the generic notion of a version containing some data, that has been committed to the repository as a member of a Contribution. Accordingly, it records the Contribution in the <code><em>contribution</em></code> attribute and the audit in <code><em>commit_audit</em></code>. A Version also knows its position in the version tree within the container. It has a version identifier, <code><em>uid</em></code>, and knows on which version in the tree it was based (i.e. what version was checked out to create the current version), <code><em>preceding_version_uid</em></code> (Void if it is the first version). Both of these identifiers are globally unique (see {openehr_model_support}#_identification_package[<code>model_support.identification</code> package] in the BASE component). These properties are abstract in the <code>Version</code> class, since they are defined as being stored or computed respectively in its subtypes.</p>
</div>
<div class="paragraph">
<p>All Versions in a given version container have a <code><em>uid</em></code> that includes the <code><em>uid</em></code> of the container; in other words, the <code><em>uid</em></code> of a Version is its container&#8217;s <code><em>uid</em></code> plus further version identification for that particular version with respect to others in the same container. The <code>Version</code>.<code><em>owner_id</em></code> function extracts the <code><em>uid</em></code> field of the owning <code>Versioned_object</code> from the <code><em>uid</em></code> of the <code>Version</code>.</p>
</div>
<div class="paragraph">
<p>The <code>Version</code> class has two subtypes. The first, <code>Original_version&lt;T&gt;</code>, represents a Version created with original content (stored form of data property) at the time of creation (including from non-S2 local feeder systems), and potentially attested (signed). It includes as attributes the current version (<code><em>uid</em></code>) and the preceding version (<code><em>preceding_version_uid</em></code>). It also knows the lifecycle state of its content. If it was the result of a merge (see <a href="#_version_merging">Section 4.2</a>) of versions other than the preceding version, the identifiers of these versions will be recorded in the attribute <code><em>other_input_version_uids</em></code>. All instances of <code>Version&lt;T&gt;</code> in non-distributed S2 systems will be instances of <code>Original_version&lt;T&gt;</code>. The <code>Original_version</code> is also the unit of copying in a distributed environment.</p>
</div>
<div class="paragraph">
<p>The second subtype is <code>Imported_version&lt;T&gt;</code>, and acts as a wrapper of an <code>Original_version&lt;T&gt;</code>. It has its own contribution and <code><em>commit_audit</em></code> (inherited from <code>Version&lt;T&gt;</code>), and contains the original version being imported in its <code><em>item</em></code> attribute. Its <code><em>uid</em></code> and <code><em>preceding_version</em></code> are defined as functions, returning the corresponding attribute values from the wrapped <code>Original_version</code> object (in other words, an <code>Imported_version</code> does not have its own version identifier distinct from the version it is wrapping). The semantics of importing are described below in <a href="#_copying">Section 4.1</a>. <a href="#instance_view_of_versioned_data">Figure 3</a> illustrates typical arrangements of <code>Original_version</code> and <code>Imported_version</code> objects within <code>Versioned_objects</code>, in turn within an EHR (if this is an EHR system), ultimately within an identified system. The two <code>Versioned_objects</code> are shown representing "medications" and "problem list", to give some idea of correspondence of versioning structures to logical data. Star icons represent digital signatures.</p>
</div>
<div id="instance_view_of_versioned_data" class="imageblock text-center text-center">
<div class="content">
<img src="change_control/diagrams/instance_view_of_versioned_data.png" alt="instance view of versioned data" width="80%">
</div>
<div class="title">Figure 3. Instance view of versioned data</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_virtual_version_tree"><a class="anchor" href="#_the_virtual_version_tree"></a>2.1.4. The 'Virtual Version Tree'</h4>
<div class="paragraph">
<p>An underlying design concept of the versioning model defined here is known as the 'virtual version tree'. The idea is simple in the abstract. Information is committed to a repository (such as an EHR) in lumps, each lump being the 'data' of one Version. Each Version has its place within a version tree, which in turn is maintained inside a Versioned object. The virtual version tree concept means that any given Versioned object may have numerous copies in various systems, and that the creation of versions in each is done in such a way that all versions so created are in fact compatible with the 'virtual' version tree resulting from the superimposition of the version trees of all copies. This is achieved using simple rules for version identification, described below, and is done to facilitate data sharing. Two very common scenarios are served by the virtual version tree concept:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>longitudinal data that stands as a proxy for the state or situation of the patient such as "Medications" or "Problem list" (persistent Compositions in S2) is created and maintained in one or more care delivery organisations, and shared across a larger number of organisations;</p>
</li>
<li>
<p>some EHRs in an EHR server in one location are mirrored into one or more other EHR servers (e.g. at care providers where the relevant patients are also treated); the mirroring process requires asynchronous synchronisation between servers to work seamlessly, regardless of the location, time, or author of any data created.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code><em>uid</em></code> attribute of the class <code>Versioned_object&lt;T&gt;</code> is in fact the Uid of the virtual version tree for a given logical item (such as the "problem list" of a certain patient) - that is to say, the <code><em>uid</em></code> will be the same in all copies of the same Versioned object in a distributed system.</p>
</div>
<div class="paragraph">
<p>The versioning scheme used in S2 guarantees that no matter where data are created or copied, there are no inconsistencies due to sharing, and that logical copies are explicitly represented. This is achieved by the design of Version identifiers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_contributions"><a class="anchor" href="#_contributions"></a>2.1.5. Contributions</h4>
<div class="paragraph">
<p>Since a versioned repository (i.e. a collection of <code>Versioned_objects</code>) is by definition indelible, all logical changes including deletions, additions, modifications (including error corrections and content changes), importing and attestations of existing items, are achieved by physically committing new Versions, or for attestations, new Attestation objects to existing Versions. Each logical type of change is achieved as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>addition of new item</em>: a new <code>Versioned_object</code> is created with a first <code>Original_version</code> whose data is the new item; the <code>Original_version.<em>commit_audit</em>.<em>change_type</em></code> is set to the code <code>249|creation|</code>;</p>
</li>
<li>
<p><em>deletion of existing item</em>: a new <code>Original_version</code> whose data attribute is set to Void is added to an existing <code>Versioned_object</code>; the <code>Original_version.<em>commit_audit</em>.<em>change_type</em></code> is set to the code <code>523|deleted|</code>;</p>
</li>
<li>
<p><em>modification of existing item</em>: a new <code>Original_version</code> whose data contains the updated form of the item content is added to an existing <code>Versioned_object</code>;</p>
<div class="ulist">
<ul>
<li>
<p>if the change is logically a correction (e.g. of wrongly entered data), the <code>Original_version.<em>commit_audit</em>.<em>change_type</em></code> is set to the code <code>250|amendment|</code>;</p>
</li>
<li>
<p>if the change is logically a change, addition etc to the content, the <code>Original_version.<em>commit_audit</em>.<em>change_type</em></code> is set to the code <code>251|modification|</code>;</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>import of item</em>: a new <code>Imported_version</code> is created, incorporating the received <code>Original_version</code>; the <code>Imported_version.<em>commit_audit</em>.<em>change_type</em></code> is set to the code for <code>249|creation|</code>.</p>
</li>
<li>
<p><em>attestation of item</em>: a new <code>Attestation</code> is added to the attestations list of an existing <code>Original_version</code>; the <code>Attestation.<em>commit_audit</em>.<em>change_type</em></code> is set to the code <code>666|attestation|</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In a typical application situation, one or more of the above changes may be committed to a repository as a Contribution. For example during a patient encounter, the following might occur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>addition</em>: a new Composition is created recording the Observations (e.g. physical examination), etc that are made during the Encounter;</p>
</li>
<li>
<p><em>modification</em>: the Composition containing the current medications list is updated, due to a prescription being given during the encounter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two changes together constitute a logical <em>change-set</em>, and would typically be included in the one Contribution. In general, there might be any combination of the logical change types in a single commit by an application, corresponding to a single real-world business event, such as a GP Encounter, although attestations, deletions and corrections will usually be the only change within a Contribution. In every case, regardless of the combination, a <code>Contribution</code> object will be created, listing the affected <code>Version</code> objects, and including its own audit object, whose <code><em>change_type</em></code> attribute captures the aggregate of the changes in the Compositions making up its <code><em>versions</em></code>. This may sometimes be approximate, and is not expected to be used as a computable value. Typical values for <code>Contribution.<em>audit</em>.<em>change_type</em></code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>251|modification|</code>: this accommodates cases where there is a mixture of creation, deletion, modification that constitute a change of content;</p>
</li>
<li>
<p><code>250|amendment|</code>: corresponds to a mixture of amendments and deletions that logically constitute a correction to the content;</p>
</li>
<li>
<p><code>666|attestation|</code>: used when the only changes are attestation of one or more of the member versions;</p>
</li>
<li>
<p>any code: when all member versions have the same change type, that change type may be used for the Contribution as well.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The list of all Contribution objects for a version repository (such as an EHR) provides a complete history of the change-sets made to the repository and is the basis for performing 'rollback' to access previous informational states of the EHR. Conversely, each Version object contains a reference to the Contribution that caused it to be created.</p>
</div>
</div>
<div class="sect3">
<h4 id="_committal_and_audits"><a class="anchor" href="#_committal_and_audits"></a>2.1.6. Committal and Audits</h4>
<div class="paragraph">
<p>Audits are recorded in the form of instances of the class <code>Audit_details</code>, which defines a set of attributes which form an audit trail, namely <code><em>system_id</em></code>, <code><em>committer</em></code>, <code><em>time_committed</em></code>, <code><em>change_type</em></code>, and <code><em>description</em></code> or its subtype <code>Attestation</code>, which adds a number of other attributes (see below). When an <code>Original_version</code> instance is created locally, the commit_audit attribute contains an audit object recording the local act of committal. However, if the Version being committed does not correspond to local data creation, but instead contains a copy of an <code>Original_version</code> originally created and committed elsewhere, it is committed locally as an instance of the <code>Imported_version</code> class. Both the contribution and commit_audit of the latter object correspond to the local act of committal, while the knowledge of the original Contribution and committal are retained inside the wrapped <code>Original_version</code> instance. Original versions can be copied any number of times; in each system into which they are imported, an <code>Imported_version</code> is created as a wrapper.</p>
</div>
<div class="paragraph">
<p>This simple scheme ensures that the audit from initial creation - which is the clinically meaningful audit - is preserved no matter how many times the Version is copied to other systems; it also ensures that from the point of view of the version container, the local commit audit and Contribution always correspond to the local act of committal.</p>
</div>
<div class="paragraph">
<p>The <code>Contribution</code> class also contains an audit attribute. Whenever a <code>Contribution</code> is committed, this attribute captures to the time, place and committer of the committal act; these three attributes (<code><em>system_id</em></code>, <code><em>committer</em></code>, <code><em>time_committed</em></code> of <code>Audit_details</code>) should be copied into the corresponding attributes of the commit_audit of each <code>Version</code> included in the <code>Contribution</code>. This is done to enable sharing of versioned entities independently of which Contributions they were part of.</p>
</div>
<div class="paragraph">
<p>The <code><em>time_committed</em></code> attribute in both the Contribution and Version audits should reflect the time of committal to an EHR server, i.e. the time of availability to other users in the same system. It should therefore be computed on the server in implementations where the data are created in a separate client context.</p>
</div>
<div class="paragraph">
<p>In terms of database management, Contributions are similar to nested transactions. An attempt to commit a Contribution should only succeed if each Version and/or Attestation in the Contribution is committed successfully.</p>
</div>
</div>
<div class="sect3">
<h4 id="_digital_signature"><a class="anchor" href="#_digital_signature"></a>2.1.7. Digital Signature</h4>
<div class="paragraph">
<p>At the time of committal of a Version, a digital signature of the object can be made. In this process, a Version object (an <code>Original_version</code> or <code>Imported_version</code>) is serialised into canonical form which is then hashed to produce a digest. If public key or equivalent infrastructure is in place so that users are able to sign content, a digital signature can be created from the hash, using the user&#8217;s private key. Either way, the result is then radix-64 encoded to create an ASCII string so as to remove or reduce potential problems with subsequent communication. The openPGP standard ensures that the trasformations and algorithms used to create the signature are indicated within it.</p>
</div>
<div class="paragraph">
<p>The signature can serve two purposes. If only the hashing step is done, the digest acts as a data integrity check, indicating if the data have been tampered with after creation. If the signing step is carried out, it authenticates the user as the author of the content to readers of the content. In a versioned EHR system, it also acts as a non-repudiation measure, since the signature is stored permanently with the data. To circumvent hacking of the data, public notarisation of the signature can be used. The signature, if present, is generated according to the openPGP standard (<a href="https://tools.ietf.org/html/rfc4880" target="_blank" rel="noopener">IETF RFC 4880</a>), following the process shown below.</p>
</div>
<div id="version_signature" class="imageblock text-center text-center">
<div class="content">
<img src="change_control/diagrams/version_signature.png" alt="version signature" width="80%">
</div>
<div class="title">Figure 4. Version signature (using openPGP)</div>
</div>
<div class="paragraph">
<p>The serialisation process works by the simple rule of serialising the entire Version object (note that the signature attribute will be Void at this point) into an agreed XML, ODIN or other text format, then applying the subsequent transformations to the serialised data, then writing the digest result back into the signature attribute. If the object to be serialised is an <code>Imported_version</code>, the process is the same - all attributes of the object are serialised and then used to generate a signature. The result will be that the <code>Imported_version</code> instance will carry its own signature which signifies the act of importing and making available locally an <code>Original_version</code> from another system.</p>
</div>
<div class="paragraph tbd">
<p><strong>To Be Determined</strong>: The exact serialisation.</p>
</div>
<div class="paragraph">
<p>It should be noted that the signing process here creates a signature of a logical form of the content, not a particular graphical or other directly human interpretable view. Usually the relationship between the data and what is seen on the screen is assumed to be 1:1 in a reliable system. If however the equivalent of a signature of a screen image or other literal form of the data are needed, then the Attestation form of the <code><em>commit_audit</em></code> is needed. This is described below.</p>
</div>
<div class="paragraph">
<p>One of the most important uses of signatures in S2 data is likely to be within EHR Extracts, since they can provide an assurance authenticity and integrity of the data to a receiver who has no knowledge of the quality of the processes used in the originating system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_attestation"><a class="anchor" href="#_attestation"></a>2.1.8. Attestation</h4>
<div class="paragraph">
<p>The <code>Original_version.<em>attestations</em></code> attribute allows attestations to be associated with the data in an original version. Attestations are treated in S2 as a kind of audit with additional attributes, and are described in detail in the <code>common.generic</code> package section of this specification. Any number of attestations to be associated with each Version in a Versioned object. Attestations can be added at any time after committal of the content being attested. They can be used as required by enter prise processes or legislation, and indicate by whom and when the item in question was attested. A digital "proof" is also required, although no assumption is made about the form of such proof.</p>
</div>
<div class="paragraph">
<p>Attestations may be used in different ways as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Signing content at committal: for some reason, the information being committed needs to be digitally signed. It may be that sensitive information is to be added to the EHR, e.g. recording the fact of sectioning of a patient under the mental health act, diagnosis of a fatal disease etc, or simply something which the user wants to sign. In this case, <code>Original_version.<em>commit_audit</em></code> is of type <code>Attestation</code> rather than <code>Audit_details</code>.</p>
</li>
<li>
<p>Marking content for review and signing: data entered and committed by a data-entry person e.g. a secretary, transcriptionist or student need to be reviewed and signed by a senior clinician. Similarly to the above case, this will cause <code>Original_version.<em>commit_audit</em></code> to be of type <code>Attestation</code>, but in this case, the Attestation will have its <code><em>is_pending</em></code> flag set True to indicate that attestation is required.</p>
</li>
<li>
<p>Post-committal signing: data committed with an Attestation in the is_pending state is reviewed and signed at a later point in tme by an appropriate member of staff. This action will cause an <code>Attestation</code> to be added to the <code>Original_version.<em>attestations</em></code> list.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Normally, Attestations refer to the entire version to which they are attached. However, it is possible for an <code>Attestation</code> instance to refer to some finer-grained item within the data of the version, such as a single <code>Entry</code> within a <code>Composition</code>.</p>
</div>
<div class="paragraph">
<p>When subsequent Versions are added, the existing Attestations can not be assumed to be valid for the new Version, since the nature of an attestation is that it records the witnessing of exactly the content displayed at the time of witnessing.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_versioning"><a class="anchor" href="#_versioning"></a>3. Versioning</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_version_lifecycle"><a class="anchor" href="#_version_lifecycle"></a>3.1. Version Lifecycle</h3>
<div class="paragraph">
<p>Content in Original versions has a lifecycle state associated with it, defined by a state machine whose states form the values of the enumeration <code>Version_lifecycle_state</code>. The state machine is shown below. The lifecycle state of a version is recorded in <code>Original_version.<em>lifecycle_state</em></code> attribute.</p>
</div>
<div id="version_lifecycle" class="imageblock text-center text-center">
<div class="content">
<img src="UML/diagrams/BASE-version_lifecycle.svg" alt="BASE version lifecycle">
</div>
<div class="title">Figure 5. <code>Original_version.<em>lifecycle_state</em></code> state machine</div>
</div>
<div class="paragraph">
<p>One basic rule that must be observed with the use of states is that any transition requires the commit of a <em>new version</em>, even if the content is otherwise unchanged. This also means that transitions through a number of successive states entails a number of commits, each recording one transition.</p>
</div>
<div class="sect3">
<h4 id="_incomplete_content"><a class="anchor" href="#_incomplete_content"></a>3.1.1. Incomplete Content</h4>
<div class="paragraph">
<p>Usually content will be committed in the <code>complete</code> state. However, in some circumstances, e.g. because the author has run out of time or due to an emergency, it may be committed as <code>incomplete</code> meaning that it is either partial and/or unreviewed. In hospitals this is a common occurrence. Unfinished content items (EHR Compositions, Demographic Parties etc) cannot be saved locally on the client machine, as this represents a security risk (since a client-side app or database is easier to compromise than a secure server). They must therefore be persisted on the server, either in the actual EHR (or other appropriate repository), or in a 'holding area' which is recognised as not being part of the primary destination record, but is still within a secure repository. Either way, the author normally retrieves the item(s) and after further work or review, promotes them into the final destination (i.e. patient EHR etc), in the <code>complete</code> state. Alternatively, the author might decide to throw them away, achieved by logical deletion, in which case the final commit is in the <code>deleted</code> state.</p>
</div>
<div class="paragraph">
<p>One of the consequences of accepting content that is semantically incomplete (e.g. may contain only partial clinical notes or incomplete demographic details) into the target EHR or other location is that it might also be technically 'incomplete', i.e. it may be missing mandatory data fields with respect to its generating archetypes. If being committed in the <code>complete</code> state, such data would be treated as invalid by the repository and rejected by the API.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In the <code>incomplete</code> state, a limited form of invalidity is allowed: mandatory attributes may be absent. Concretely, single-valued attributes may have null values and container attributes may be empty, even though they may have minimum existence and cardinality respectively of one. All other validity requirements must be satisfied. In other words, in an <code>incomplete</code> commit, data may be missing, but it may not be wrong.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At an implementation level, templated and archetyped data being committed in the <code>incomplete</code> state therefore respects the same template and archetype(s), but with all existence and cardinality lower limits set to zero.</p>
</div>
<div class="paragraph">
<p>Transitioning from <code>incomplete</code> to <code>complete</code> states requires any missing fields to be populated. However, even if the <code>incomplete</code> content was technically valid and no new content is added, the transition to <code>complete</code> will generate a new <code>Version</code> regardless.</p>
</div>
<div class="paragraph">
<p>Systems and/or applications are responsible for implementing checks to find 'old' Versions in the <code>incomplete</code> state, and bring them to the relevant user&#8217;s notice, or automatically deleting them or progressing them to <code>complete</code> in a reasonable way.</p>
</div>
</div>
<div class="sect3">
<h4 id="_abandoned_and_inactive_states"><a class="anchor" href="#_abandoned_and_inactive_states"></a>3.1.2. Abandoned and Inactive States</h4>
<div class="paragraph">
<p>A content item that is in the <code>incomplete</code> state may lose relevance before it is ever completed, e.g. due to its data subject no longer being under care. The version containing such an item may be transitioned to the <code>abandoned</code> state to represent this state of affairs. If circumstances change again and the abandoned item once more becomes relevant, it may be transitioned back to the <code>incomplete</code> state via the <code>retrieve</code> transition.</p>
</div>
<div class="paragraph">
<p>An Original version may also be marked as being in the <code>inactive</code> state. This allows content that is understood as informationally valid with respect to the real world activities it represents - regardless of completion status - to be marked as no longer valid for use. The exact meaning of 'valid' will depend on the content: it may be that the content is no longer relevant or useful with respect to its original purpose. An <code>inactive</code> item may be reactivated back to the <code>complete</code> state, or retrieved back to the <code>incomplete</code> state (see table below for examples of when).</p>
</div>
<div class="paragraph">
<p>An abandoned or inactive content item may be deleted at any time, if it is determined to be of no potential future use.</p>
</div>
<div class="paragraph">
<p>The transitions related to the <code>abandoned</code> and <code>inactive</code> states are as follows, using a 'care plan' as the versioned content.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Initial<br>
 State</th>
<th class="tableblock halign-left valign-top">Transition</th>
<th class="tableblock halign-left valign-top">Target<br>
                                 State</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>incomplete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>abandon</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>abandoned</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A new care plan (the version content) was made in rehabilitation centre, but patient transferred to hospital before care plan was completed.
                                                 The draft care plan is abandoned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>abandoned</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retrieve</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>incomplete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Patient returns to rehab and care is resumed; the abandoned draft care plan is therefore brought back into use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>abandoned</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Previously abandoned care plan determined to be of no further use, and deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>complete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deactivate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inactive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A care plan (the version content) is in active use. Subsequently, the patient is discharged and the care plan is no longer actively maintained.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inactive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reactivate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>complete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Patient is readmitted after discharge and the care plan is reactivated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inactive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retrieve</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>incomplete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An inactive care plan is used as the draft for a new care plan.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inactive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Previously de-activated care plan determined to be of no further use, and deleted.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The most common of these transitions is likely to be <code>deactivate</code>, i.e. marking of the content as inactive once its operational relevance ceases.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_logical_deletion"><a class="anchor" href="#_logical_deletion"></a>3.2. Logical Deletion</h3>
<div class="paragraph">
<p>Within the lifecycle described above, deletion of existing top-level content items (i.e. the entire data contents of a Version) is somewhat of a special case in S2 and in EHRs in general. Medico-legal and traceability requirements mean that information cannot be literally removed, since it must always be possible to revert back to a previous state of the record in which the deleted information is intact. Accordingly, information can only ever be logically deleted. This is achieved by the following procedure in the Version container in question:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create a new Version in the normal way;</p>
</li>
<li>
<p>delete its <code><em>data</em></code> (which will by default be a copy of the data of the previous Version);</p>
</li>
<li>
<p>set the <code><em>lifecycle_state</em></code> value to the code for <code>deleted</code>;</p>
</li>
<li>
<p>commit in the normal way.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Logical deletion can be used for various reasons, including patient direction to remove material, and in the situation where information about a different patient has been incorrectly committed to a record, and has to be removed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_version_identification"><a class="anchor" href="#_version_identification"></a>3.3. Version Identification</h3>
<div class="paragraph">
<p>The version identification scheme described here is adapted from <span class="citation">(<a href="#Hntynka2004">Hntynka &amp; Plil&#44; 2004</a>)</span>. <code>Version</code> objects are identified by a <code><em>uid</em></code> attribute of type <code>OBJECT_VERSION_ID</code>, which is a three-part String identifier consisting of the sub-parts extractable via the accessors <code><em>object_id()</em></code>, <code><em>creating_system_id()</em></code> and <code><em>version_tree_id()</em></code> (see the {openehr_model_support}#_identification_package[<code>model_support.identification</code> package] in the BASE component), in which the <code><em>object_id()</em></code> part is a copy of the <code><em>uid</em></code> of the owning <code>Versioned_object</code> version container.</p>
</div>
<div class="paragraph">
<p>The following figure illustrates the scheme. The <code>Versioned_object.<em>uid</em></code> value - here, <code>"1234"</code> - is used as the <code><em>object_id()</em></code> part of the <code><em>uid</em></code> of every contained <code>Version</code>. Accordingly, each of those versions will have a <code><em>uid</em></code> following the pattern <code>"1234:system_id:version_tree_id"</code>. The use of the <code><em>version_tree_id</em></code> and <code><em>system_id</em></code> parts of the identifier are explained in the sections below. The function <code>Version.<em>owner_id()</em></code> is provided to enable a caller to easily obtain the 'owning version container' identifier.</p>
</div>
<div id="version_identification_system" class="imageblock text-center text-center">
<div class="content">
<img src="change_control/diagrams/version_identification_system.svg" alt="version identification system" width="80%">
</div>
<div class="title">Figure 6. Version identification system</div>
</div>
<div class="paragraph">
<p>The following figure provides an example of multiple <code>VERSIONs</code> within a <code>Versioned_object</code>, where one of the versions has been merged from another system. This highlights the identifiers; details of original and merged versions are described below.</p>
</div>
<div id="version_identification_example" class="imageblock text-center text-center">
<div class="content">
<img src="change_control/diagrams/version_identification_example.svg" alt="version identification example" width="80%">
</div>
<div class="title">Figure 7. Version identification Example</div>
</div>
<div class="sect3">
<h4 id="_local_versioning"><a class="anchor" href="#_local_versioning"></a>3.3.1. Local Versioning</h4>
<div class="paragraph">
<p>The <code><em>version_tree_id</em></code> attribute of <code>Version.<em>uid</em></code> identifies a version of an item with respect to other versions in the same tree. The requirements of the identifier are the same as for typical versioning systems in use in software configuration management, and are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to encode the relationship between versions in the version id, that is to say, version identifiers are constructed such that given a series of identifiers, the relative positions in the tree can be determined;</p>
</li>
<li>
<p>to allow for branches, so that variants of a particular node can be created; e.g. due to translation, or for training purposes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A suitable scheme satisfying the above requirements for health information is the simplest possible, i.e. a single number representing the version. Version identifiers thus start at 1 and continue by single increments. The succession of version identifiers formed by changes over time is known as the "trunk" of the version tree.</p>
</div>
<div class="paragraph">
<p>To support branching, a further pair of numbers is added. The first number identifies the branch (e.g. the 1st branch, 2nd branch etc from that trunk node), while the second identifies the version. Both of these numbers also start at '1'. The result of this is that version numbers like '1.1.1' (first version of first branch from trunk node 1), '2.3.3' (3rd version of 3rd branch from trunk node 2) are possible. Inside S2 systems where sharing with other systems does not occur, it is expected that branched versioning will be used rarely; translation is likely to be the only reason (for example if a Portuguese translation of an English language version of a Composition is made).</p>
</div>
</div>
<div class="sect3">
<h4 id="_distributed_versioning"><a class="anchor" href="#_distributed_versioning"></a>3.3.2. Distributed Versioning</h4>
<div class="paragraph">
<p>However, in a distributed environment where copying and subsequent modification can occur, there are more requirements of the version identification scheme, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it must be possible for an item to be copied and for local modifications then to be made without causing version clashes;</p>
</li>
<li>
<p>it must be possible to send more recent versions from the original system to a target system that has already received earlier versions, and for these versions to be distinguishable from versions in the receiving system, including the previously imported versions - this enables the receiving system to know how and where to commit the received versions;</p>
</li>
<li>
<p>it must be guaranteed that any version of any object is uniquely identified globally, no matter whether it is a locally created trunk version, a locally created branch version or a version containing changes made to a copied version.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To satisfy these needs, two modifications are made to the identification scheme. The first is the addition of the <code><em>creating_system_id</em></code> attribute of <code>Version.<em>uid</em></code>, representing the system where the version was created. This is a machine processable identifier, such as a reverse internet address or GUID.</p>
</div>
<div class="paragraph">
<p>Whenever a new <code>Original_version</code> in a particular <code>Versioned_object</code> (with a particular Uid) is created locally, the <code>Version.<em>uid.creating_system_id</em></code> is set to the identifier of the local system; if the version was imported, <code><em>creating_system_id</em></code> will already have been set to the identifier of the system of original creation.</p>
</div>
<div class="paragraph">
<p>The second modification is to require branching version identifiers to be used when local modifications are made to versions copied from elsewhere; this ensures that the modifications now being made in the target system are considered in a global sense as logical branches or variants rather than trunk versions which are made in the originating system. It also allows later trunk versions from the originating system to be copied at some future time to the target system without version identifier clashes. In summary, the scheme uses the tuple {<code><em>object_id</em></code>, <code><em>creating_system_id</em></code>, <code><em>version_tree_id</em></code>} to globally uniquely identify any S2 <code>Version</code> object.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_class_descriptions"><a class="anchor" href="#_class_descriptions"></a>3.4. Class Descriptions</h3>
<div class="sect3">
<h4 id="_versioned_object_class"><a class="anchor" href="#_versioned_object_class"></a>3.4.1. Versioned_object Class</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Class</strong></p></th>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Versioned_object&lt;T&gt;</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Description</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p>Version control abstraction, defining semantics for versioning one complex object.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Attributes</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>uid</strong>: <code><a href="#_uuid_class">Uuid</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unique identifier of this version container in the form of a UID with no extension. This id will be the same in all instances of the same container in a distributed environment, meaning that it can be understood as the uid of the  virtual version tree.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>owner_id</strong>: <code><a href="#_object_ref_class">Object_ref</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Reference to object to which this version container belongs, e.g. the id of the containing EHR or other relevant owning entity.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>time_created</strong>: <code>@@</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Time of initial creation of this versioned object.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Functions</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>version_count</strong> (): <code><a href="#_integer_class">Integer</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Return the total number of versions in this object.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>all_version_ids</strong> (): <code>List&lt;<a href="#_object_id_class">Object_id</a>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Return a list of ids of all versions in this object.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>all_versions</strong> (): <code>List&lt;<a href="#_version_class">Version</a>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Return a list of all versions in this object.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>has_version_at_time</strong> (<br>
a_time<br>
): <code><a href="#_boolean_class">Boolean</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>True if a version for time  <code><em>a_time</em></code> exists.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>has_version_id</strong> (<br>
a_version_uid: <code><a href="#_object_id_class">Object_id</a>[1]</code><br>
): <code><a href="#_boolean_class">Boolean</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>True if a version with <code><em>a_version_uid</em></code> exists.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>version_with_id</strong> (<br>
a_version_uid: <code><a href="#_object_id_class">Object_id</a>[1]</code><br>
): <code><a href="#_version_class">Version</a></code><br>
<br>
<em>Pre</em>: <code>has_version_id (a_ver_id)</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Return the version with <code><em>uid</em></code> =  <code><em>a_version_uid</em></code>.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>is_original_version</strong> (<br>
a_version_uid: <code><a href="#_object_id_class">Object_id</a>[1]</code><br>
): <code><a href="#_boolean_class">Boolean</a></code><br>
<br>
<em>Pre</em>: <code>has_version_id(a_ver_id)</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>True if version with <code><em>a_version_uid</em></code> is an <code>ORIGINAL_VERSION</code>.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>version_at_time</strong> (<br>
a_time<br>
): <code><a href="#_version_class">Version</a></code><br>
<br>
<em>Pre</em>: <code>has_version_at_time (a_time)</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Return the version for time  <code><em>a_time</em></code>.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>revision_history</strong> ()</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>History of all audits and attestations in this versioned repository.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>latest_version</strong> (): <code><a href="#_version_class">Version</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Return the most recently added version (i.e. on trunk or any branch).</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>latest_trunk_version</strong> (): <code><a href="#_version_class">Version</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Return the most recently added trunk version.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>trunk_lifecycle_state</strong> (): <code><a href="#_version_lifecycle_state_enumeration">Version_lifecycle_state</a></code><br>
<br>
<em>Post</em>: <code>Result = latest_trunk_version.lifecycle_state</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Return the lifecycle state from the latest trunk version. Useful for determining if the version container is logically deleted.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>commit_original_version</strong> (<br>
a_contribution: <code><a href="#_object_ref_class">Object_ref</a>[1]</code>,<br>
a_new_version_uid: <code><a href="#_object_id_class">Object_id</a>[1]</code>,<br>
a_preceding_version_id: <code><a href="#_object_id_class">Object_id</a>[1]</code>,<br>
an_audit: <code><a href="#_audit_details_class">Audit_details</a>[1]</code>,<br>
a_lifecycle_state: <code><a href="#_coded_text_class">Coded_text</a>[1]</code>,<br>
a_data: <code>T[1]</code>,<br>
signing_key: <code><a href="#_string_class">String</a>[1]</code><br>
): <code>void</code><br>
<br>
<em>Pre</em>: <code>all_version_ids.has (a_preceding_version_uid) or else version_count = 0</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Add a new original version.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>commit_original_merged_version</strong> (<br>
a_contribution: <code><a href="#_object_ref_class">Object_ref</a>[1]</code>,<br>
a_new_version_uid: <code><a href="#_object_id_class">Object_id</a>[1]</code>,<br>
a_preceding_version_id: <code><a href="#_object_id_class">Object_id</a>[1]</code>,<br>
an_audit: <code><a href="#_audit_details_class">Audit_details</a>[1]</code>,<br>
a_lifecycle_state: <code><a href="#_coded_text_class">Coded_text</a>[1]</code>,<br>
a_data: <code>T[1]</code>,<br>
an_other_input_uids: <code>List&lt;<a href="#_object_id_class">Object_id</a>&gt;[1]</code>,<br>
signing_key: <code><a href="#_string_class">String</a>[1]</code><br>
): <code>void</code><br>
<br>
<em>Pre</em>: <code>all_version_ids.has (a_preceding_version_uid) or else version_count = 0</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Add a new original merged version. This commit function adds a parameter containing the ids of other versions merged into the current one.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>commit_imported_version</strong> (<br>
a_contribution: <code><a href="#_object_ref_class">Object_ref</a>[1]</code>,<br>
an_audit: <code><a href="#_audit_details_class">Audit_details</a>[1]</code>,<br>
a_version: <code><a href="#_original_version_class">Original_version</a>[1]</code><br>
): <code>void</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Add a new imported version. Details of version id etc come from the <code>ORIGINAL_VERSION</code> being committed.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>commit_attestation</strong> (<br>
an_attestation: <code><a href="#_attestation_class">Attestation</a>[1]</code>,<br>
a_ver_id: <code><a href="#_object_id_class">Object_id</a>[1]</code>,<br>
signing_key: <code><a href="#_string_class">String</a>[1]</code><br>
): <code>void</code><br>
<br>
<em>Pre</em>: <code>has_version_id(a_ver_id)
and is_original_version(a_ver_id)</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Add a new attestation to a specified original version. Attestations can only be added to Original versions.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Invariants</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>Version_count_valid</em>: <code>version_count &gt;= 0</code></p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>All_version_ids_valid</em>: <code>all_version_ids.count = version_count</code></p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>All_versions_valid</em>: <code>all_versions.count = version_count</code></p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>Latest_version_valid</em>: <code>version_count &gt; 0 implies latest_version /= Void</code></p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>Uid_validity</em>: <code>extension.is_empty</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_version_class"><a class="anchor" href="#_version_class"></a>3.4.2. Version Class</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Class</strong></p></th>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong><em>Version&lt;T&gt; (abstract)</em></strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Description</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p>Abstract model of one Version within a Version container, containing data, commit audit trail, and the identifier of its Contribution.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Attributes</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>contribution</strong>: <code><a href="#_object_ref_class">Object_ref</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Contribution in which this version was added.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>0..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>signature</strong>: <code><a href="#_string_class">String</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OpenPGP digital signature or digest of content committed in this Version.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>commit_audit</strong>: <code><a href="#_audit_details_class">Audit_details</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Audit trail corresponding to the committal of this version to the <code>VERSIONED_OBJECT</code>.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Functions</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1<br>
(abstract)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>uid</strong> (): <code><a href="#_object_id_class">Object_id</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unique identifier of this <code>VERSION</code>, in the form of an <code>{object_id, a version_tree_id, creating_system_id}</code> triple, where the <code><em>object_id</em></code> has the same value as the containing <code>VERSIONED_OBJECT <em>uid</em></code>.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1<br>
(abstract)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>preceding_version_uid</strong> (): <code><a href="#_object_id_class">Object_id</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unique identifier of the version of which this version is a modification; Void if this is the first version.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1<br>
(abstract)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>data</strong> (): <code>T</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The data of this Version.
Original content of this Version.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1<br>
(abstract)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>lifecycle_state</strong> (): <code><a href="#_version_lifecycle_state_enumeration">Version_lifecycle_state</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Lifecycle state of this version; coded by openEHR vocabulary <code>version lifecycle state</code>.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>canonical_form</strong> (): <code><a href="#_string_class">String</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A canonical serial form of this Version, suitable for generating reliable hashes and signatures.
Canonical form of Version object, created by serialising all attributes except
signature.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>owner_id</strong> (): <code><a href="#_uuid_class">Uuid</a></code><br>
<br>
<em>Post</em>: <code>Result.value.is_equal (uid.object_id.value)</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Copy of the owning <code>VERSIONED_OBJECT.<em>uid</em></code> value; extracted from the local <code><em>uid</em></code> property&#8217;s <code><em>object_id</em></code>.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>is_branch</strong> (): <code><a href="#_boolean_class">Boolean</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>True if this Version represents a branch. Derived from <code><em>uid</em></code> attribute.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Invariants</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>Preceding_version_uid_validity</em>: <code>uid.version_tree_id.is_first xor preceding_version_uid /= Void</code></p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>Lifecycle_state_ valid</em>: <code>lifecycle_state /= Void and then terminology (Term_id_openehr).has_code_for_group_id (Group_id_version_lifecycle_state, lifecycle_state.defining_code)</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_original_version_class"><a class="anchor" href="#_original_version_class"></a>3.4.3. Original_version Class</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Class</strong></p></th>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Original_version&lt;T&gt;</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Description</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p>A Version containing locally created content and optional attestations.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Inherit</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><a href="#_version_class">Version</a></code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Attributes</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>uid</strong>: <code><a href="#_object_id_class">Object_id</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Stored version of inheritance precursor.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>0..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>preceding_version_uid</strong>: <code><a href="#_object_id_class">Object_id</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Stored version of inheritance precursor.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>0..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>other_input_version_uids</strong>: <code>List&lt;<a href="#_object_id_class">Object_id</a>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Identifiers of other versions whose content was merged into this version, if any.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>lifecycle_state</strong>: <code><a href="#_version_lifecycle_state_enumeration">Version_lifecycle_state</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Lifecycle state of the content item in this version; coded by openEHR vocabulary <code>version lifecycle state</code>.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>0..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>attestations</strong>: <code>List&lt;<a href="#_attestation_class">Attestation</a>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set of attestations relating to this version.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>0..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>data</strong>: <code>T</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Data content of this Version.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Functions</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>is_merged</strong> (): <code><a href="#_boolean_class">Boolean</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>True if this Version was created from more than just the preceding (checked out) version.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Invariants</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>Attestations_valid</em>: <code>attestations /= Void implies not attestations.is_empty</code></p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>Is_merged_validity</em>: <code>other_input_version_ids = Void xor is_merged</code></p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>Other_input_version_uids_valid</em>: <code>other_input_version_uids /= Void implies not other_input_version_uids.is_empty</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_imported_version_class"><a class="anchor" href="#_imported_version_class"></a>3.4.4. Imported_version Class</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Class</strong></p></th>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Imported_version&lt;T&gt;</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Description</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p>Versions whose content is an <code>ORIGINAL_VERSION</code> copied from another location; this class inherits <code><em>commit_audit</em></code> and <code><em>contribution</em></code> from <code>VERSION&lt;T&gt;</code>, providing imported versions with their own audit trail and Contribution, distinct from those of the imported <code>ORIGINAL_VERSION</code>.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Inherit</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><a href="#_version_class">Version</a></code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Attributes</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>item</strong>: <code><a href="#_original_version_class">Original_version</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The <code>ORIGINAL_VERSION</code> object that was imported.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Functions</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1<br>
(effected)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>uid</strong> (): <code><a href="#_object_id_class">Object_id</a></code><br>
<br>
<em>Post</em>: <code>Result = item.uid</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Computed version of inheritance precursor, derived as <code><em>item.uid</em></code>.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1<br>
(effected)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>preceding_version_uid</strong> (): <code><a href="#_object_id_class">Object_id</a></code><br>
<br>
<em>Post</em>: <code>Result = item.preceding_version_uid</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Computed version of inheritance precursor, derived as <code><em>item.preceding_version_uid</em></code>.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1<br>
(effected)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>lifecycle_state</strong> (): <code><a href="#_version_lifecycle_state_enumeration">Version_lifecycle_state</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Lifecycle state of the content item in wrapped <code>ORIGINAL_VERSION</code>, derived as <code><em>item.lifecycle_state</em></code>; coded by openEHR vocabulary <code>version lifecycle state</code>.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1<br>
(effected)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>data</strong> (): <code>T</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Original content of this Version.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_contribution_class"><a class="anchor" href="#_contribution_class"></a>3.4.5. Contribution Class</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Class</strong></p></th>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Contribution</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Description</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p>Documents a Contribution (change set) of one or more versions added to a change-controlled repository.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Attributes</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>uid</strong>: <code><a href="#_uuid_class">Uuid</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unique identifier for this Contribution.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>versions</strong>: <code>List&lt;<a href="#_object_ref_class">Object_ref</a>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set of references to Versions causing changes to this EHR. Each contribution contains a list of versions, which may include paths pointing to any number of versionable items, i.e. items of types such as <code>COMPOSITION</code> and <code>FOLDER</code>.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>audit</strong>: <code><a href="#_audit_details_class">Audit_details</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Audit trail corresponding to the committal of this Contribution.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_audit_details_class"><a class="anchor" href="#_audit_details_class"></a>3.4.6. Audit_details Class</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Class</strong></p></th>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Audit_details</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Description</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p>The set of attributes required to document the committal of an information item to a repository.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Attributes</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>system_id</strong>: <code><a href="#_string_class">String</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Identifier of the logical EHR system where the change was committed. This is almost always owned by the organisation legally responsible for the EHR, and is distinct from any application, or any hosting infrastructure.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>time_committed</strong>: <code><a href="#_date_time_class">Date_time</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Time of committal of the item.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>change_type</strong>: <code><a href="#_audit_change_type_enumeration">Audit_change_type</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Type of change. Coded using the openEHR Terminology  audit change type  group.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>0..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reason</strong>: <code><a href="#_plain_text_class">Plain_text</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Reason for committal. This may be used to qualify the value in the <code><em>change_type</em></code> field. For example, if the change affects only the EHR directory, this field might be used to indicate 'Folder "episode 2018-02-16" added' or similar.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>committer</strong>: <code><a href="#_entity_ref_node_class">Entity_ref_node</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Identity and optional reference into identity management service, of user who committed the item.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Invariants</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>System_id_valid</em>: <code>not system_id.is_empty</code></p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>Change_type_valid</em>: <code>terminology (Terminology_id_openehr).has_code_for_group_id (Group_id_audit_change_type, change_type.defining_code)</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_attestation_class"><a class="anchor" href="#_attestation_class"></a>3.4.7. Attestation Class</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Class</strong></p></th>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Attestation</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Description</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p>Record an attestation of a party (the committer) to item(s) of record content. An attestation is an explicit signing by one healthcare agent of particular content for various particular purposes, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for authorisation of a controlled substance or procedure (e.g. sectioning of patient under mental health act);</p>
</li>
<li>
<p>witnessing of content by senior clinical professional;</p>
</li>
<li>
<p>indicating acknowledgement of content by intended recipient, e.g. GP who ordered a test result.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Inherit</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><a href="#_audit_details_class">Audit_details</a></code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Attributes</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>0..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>attested_view</strong>: <code><a href="#_multimedia_class">Multimedia</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional visual representation of content attested e.g. screen image.</p>
</div>
<div class="paragraph">
<p>TODO: fix data type.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>0..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>proof</strong>: <code><a href="#_string_class">String</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Proof of attestation.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>is_pending</strong>: <code><a href="#_boolean_class">Boolean</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>True if this attestation is outstanding; False means it has been completed.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>1..1<br>
(redefined)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reason</strong>: <code><a href="#_attestation_reason_enumeration">Attestation_reason</a></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Reason of this attestation. Optionally coded by the openEHR Terminology group  attestation reason ; includes values like  authorisation ,  witness  etc.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Invariants</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>Items_valid</em>: <code>items /= Void implies not items.is_empty</code></p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><em>Reason_valid</em>: <code>(reason.generating_type.is_equal (DV_CODED_TEXT) implies terminology (Terminology_id_openehr).has_code_for_group_id (Group_id_attestation_reason, reason.defining_code))</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_audit_change_type_enumeration"><a class="anchor" href="#_audit_change_type_enumeration"></a>3.4.8. Audit_change_type Enumeration</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Enumeration</strong></p></th>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Audit_change_type</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Description</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Attributes</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">creation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">amendment</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">modification</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">synthesis</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleted</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">attestation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">restoration</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">format conversion</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">other</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_attestation_reason_enumeration"><a class="anchor" href="#_attestation_reason_enumeration"></a>3.4.9. Attestation_reason Enumeration</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Enumeration</strong></p></th>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Attestation_reason</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Description</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Attributes</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">signed</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">witnessed</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_version_lifecycle_state_enumeration"><a class="anchor" href="#_version_lifecycle_state_enumeration"></a>3.4.10. Version_lifecycle_state Enumeration</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Enumeration</strong></p></th>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Version_lifecycle_state</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Description</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Attributes</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">initial</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">incomplete</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">abandoned</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleted</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">inactive</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">complete</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_semantics_in_distributed_systems"><a class="anchor" href="#_semantics_in_distributed_systems"></a>4. Semantics in Distributed Systems</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_copying"><a class="anchor" href="#_copying"></a>4.1. Copying</h3>
<div class="sect3">
<h4 id="_the_copy_operation"><a class="anchor" href="#_the_copy_operation"></a>4.1.1. The Copy Operation</h4>
<div class="paragraph">
<p>In S2, the smallest unit of copying of content between systems that satisfies traceability requirements is the <code>Original_version</code>. In order to copy a <code>Observation</code> or even an <code>Composition</code> somewhere else and retain versioning capability, its enclosing <code>Original_version</code> object must be sent. When the type of content is a <code>Composition</code> for example, an <code>Original_version&lt;Composition&gt;</code> object is sent. At the receiving system various steps will occur depending on whether:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>any items for the EHR in question have ever been copied before;</p>
</li>
<li>
<p>a copied EHR exists in the destination system for the subject of care, but no copies of the particular item in question have even been made (e.g. it is the first time Family History has been copied);</p>
</li>
<li>
<p>an EHR exists, and previous copies have been made for the item in question;</p>
</li>
<li>
<p>there is a duplicate EHR for the subject of care (i.e. created by new data entry rather than by automatic copying).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the first situation, there is not even an EHR (i.e. repository of Versioned objects for the patient in question) in the target system. A new one has to be created. As mentioned in the <a href="https://specifications.openehr.org/releases/RM/latest/ehr.html#_ehr_creation_semantics">EHR IM specification</a>, the newly created EHR should re-use the EHR identifier from the source system. This establishes the new EHR as an intentional clone of the source EHR (or more correctly, part of the family of EHRs making up the virtual EHR for that patient).</p>
</div>
<div class="paragraph">
<p>If it is the first time any version of the item logically identified by its <code>Original_version.<em>uid.object_id()</em></code> (i.e. the <code><em>uid</em></code> of its original <code>Versioned_object</code>, common to all Versions in the same container) was received from the originating system, a new <code>Versioned_object&lt;T&gt;</code> (e.g. <code>Versioned_object&lt;Composition&gt;</code>) is created, with its uid set to the same value as the received <code>Version.<em>uid.object_id()</em></code>. This establishes the newly created <code>Versioned_object</code> as being a logical clone of the one from which the received <code>Original_version</code> was copied. If some version of the item had already been received, this step will have already occurred, and the requisite <code>Versioned_object</code> would already exist.</p>
</div>
<div class="paragraph">
<p>An <code>Imported_version</code> instance is then created, its item set to the received <code>Original_version</code>, and it is committed in the normal way (i.e. as part of a Contribution). The <code>Imported_version</code> <code><em>commit_audit</em></code> and <code><em>contribution</em></code> attributes record the local act of committal. In this operation, the <code>Original_version</code> instance is never modified - it remains a faithful copy of its original, no matter how many systems it may be copied through.</p>
</div>
</div>
<div class="sect3">
<h4 id="_subsequent_local_modifications"><a class="anchor" href="#_subsequent_local_modifications"></a>4.1.2. Subsequent Local Modifications</h4>
<div class="paragraph">
<p>In most cases, the received information will remain as is for the duration. However, in some cases, users at the receiver system might want to make modifications as well. This is likely to happen in the case of information items representing things like medication and allergies lists. When new versions are added locally to a copied object, the local system id is recorded in the <code><em>uid.creating_system_id()</em></code> attribute, while branching numbering is used in the <code><em>uid.version_tree_id()</em></code>.</p>
</div>
<div class="paragraph">
<p>These copying scenarios are illustrated in the figure below. On the left hand-side of the figure, a version container (i.e. an instance of <code>Versioned_object</code>) with <code><em>uid</em></code> = <code>"1"</code> is shown; the first Version has <code><em>uid.creating_system_id</em></code> = <code>"sysA"</code>; <code><em>uid.version_tree_id</em></code> = <code>"1"</code>. Further local trunk and branch versions are also shown.</p>
</div>
<div id="distributed_versioning" class="imageblock text-center text-center">
<div class="content">
<img src="change_control/diagrams/distributed_versioning.png" alt="distributed versioning" width="70%">
</div>
<div class="title">Figure 8. Distributed versioning</div>
</div>
<div class="paragraph">
<p>When the first <code>Original_version</code> is copied (copy #1) to system B, it is committed as an <code>Imported_version</code> to a <code>Versioned_object</code> which is a clone of the original. Subsequent copies (copy #2 and copy #3) can be made of later versions from system A to system B, with the effect that the version tree can be recreated inside system B (if required; there is of course no obligation to do anything with the received information). Users in system B an also make modifications to the received Version copies; these modifications are shown in grey, as branched versions with <code><em>uid.creating_system_id</em></code> = <code>"sysB"</code>. Independently, users in system B will of course be creating other content locally, e.g. as shown on the right-hand side, where a Versioned object with <code><em>uid</em></code>= <code>"2"</code> has been created. Two places are indicated on the diagram where identification clashes could have occurred, but are prevented due to the use of the 3-part unique Version identifier scheme.</p>
</div>
<div class="paragraph">
<p>Two rules are required to make this system work, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>branch versions from the original systems that are copied to another system cannot be copied without their corresponding preceding versions on the same branch (if any) and trunk versions also being copied;</p>
</li>
<li>
<p>no system should create a new Versioned object (with a new uid) without first determining that it does not already have one with the same uid. This should happen automatically if GUIDs are being used (and the generating software is reliable); checks may have to be made if ISO Oids are being used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An important consequence of the way <code>Imported_version</code> is modelled is that in the Version containers resulting from copy operations, the commit times always reflect the local (more recent) act of committal, not the original committal of the information to the container where it was created. This ensures that a query for the state of a Version container at earlier commit times correctly returns what information existed at that time in that container, rather than giving the illusion that recently copied Versions were there earlier than the time of local committal (as would occur if the original commit time of the <code>Original_version</code> object was used for comparison purposes in such queries). Accordingly, such a query over an entire EHR or other versioned information repository always returns the state of the repository available to users at that time, regardless of how many later merges or copies were carried out. This is a key requirement for supporting medico-legal and historical investigations of stored information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_version_merging"><a class="anchor" href="#_version_merging"></a>4.2. Version Merging</h3>
<div class="paragraph">
<p>One of the most common operations in distributed versioned environments, particularly in healthcare, is that content created in one system is imported into another system, modified in the receiving system and subsequently sent back to the first system. This information pathway corresponds to scenarios such as the patient being referred from primary care into a hospital, and later being discharged into primary (or other care).</p>
</div>
<div class="paragraph">
<p>The usual need when the first system receives changes made to the data by the second system is to merge them back into the trunk of the version tree. Logically a 'merge' is the operation of using two versions of the same content to create a third version. How the source versions are used will vary based on the semantics of the information; it could be that the either is simply taken in its totality and the other discarded, or some mixture might be created of the two in a process of editing by the user. In many cases in health, such as where the content is a medication or problem list, the user in the original system will review the received content and create a new trunk version locally using that content, since it will be deemed to be the most accurate available in the clinical computing environment. This scenario is illustrated below.</p>
</div>
<div id="version_merging" class="imageblock text-center text-center">
<div class="content">
<img src="change_control/diagrams/version_merging.png" alt="version merging" width="60%">
</div>
<div class="title">Figure 9. Version merging</div>
</div>
<div class="paragraph">
<p>In this figure, versions 1 and 2 of the content (e.g. a medication list) from Versioned object with <code><em>uid</em></code>= <code>1</code> are copied from system A (e.g. a GP) to system B (e.g. a hospital). In system B, changes are made to version 2, creating a branch (as an instance of <code>Imported_version&lt;T&gt;</code>) as required by the rules described above. These changes (modified medication list) are then imported back into system A. The system A user performs a merge operation to create a new trunk version 3, using the <code>sysB::2.1.2</code> and <code>sysA::2</code> content as input, in which he may do any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use the <code>sysB::2.1.2</code> (most recent) content unchanged;</p>
</li>
<li>
<p>retain the <code>sysA::2</code> content as being more correct, despite the more recent information in the <code>sysB::2.1.2</code> version (which might be clinically incorrect, or out of date, despite being entered more recently);</p>
</li>
<li>
<p>reconcile the information from the two versions in a synthesised form that now best represents the known reality for the patient.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all cases, the result is that system A now has an up-to-date medication list for the patient, as judged by the merging clinician. The new Version is an instance of <code>Original_version&lt;T&gt;</code>, and the <code><em>other_input_version_uids</em></code> attribute is updated to include the <code>OBJECT_VERSION_ID</code> representing <code>sysB::2.1.2</code>. This should be done even if its content was not used in the merge, since it indicates which source versions were considered in the merge operation. It does not need to include <code>sysA::2</code>, since this is already known in the <code><em>preceding_version_uid</em></code>.</p>
</div>
<div class="paragraph">
<p>If in system A a modification had been done to the <code>sysA::2</code> version, creating <code>sysA::3</code>, in parallel with the system B changes, then a conflict situation is likely when the merge attempt is made. This may need to be resolved by a human user, for whom an automated merge attempt could be presented on the screen as a starting point, much as current source code control tools do today.</p>
</div>
</div>
<div class="sect2">
<h3 id="_disjoint_merging"><a class="anchor" href="#_disjoint_merging"></a>4.3. Disjoint Merging</h3>
<div class="paragraph">
<p>An unintended but not uncommon situation is when distinct Version containers are created for the same real-world entity. For example, separate EHRs can be created for the one patient, due to patient identification errors or other procedural or administrative problems. Each record is likely to contain some logically duplicated basic information, as well as information unique to that record, e.g. contributed by different hospital departments. Within the one EHR, unintentionally distinct Version containers might be created for the same logical item, such as the patient&#8217;s problem list. These erroneous situations are eventually detected, and need to be rectified. Logically what is required is to merge the two records (each potentially consisting of numerous Version containers) into one, as shown below.</p>
</div>
<div id="disjoint_merging" class="imageblock text-center text-center">
<div class="content">
<img src="change_control/diagrams/disjoint_merging.png" alt="disjoint merging" width="80%">
</div>
<div class="title">Figure 10. Disjoint merging</div>
</div>
<div class="paragraph">
<p>The merge procedure is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>decide which record is to remain active (for merging purposes, this will be the 'target', the other the 'source');</p>
</li>
<li>
<p>for all Version containers in the source record&#8230;&#8203;</p>
<div class="ulist">
<ul>
<li>
<p>if there is a logical equivalent in the target record (for EHRs, there will typically only be equivalents for persistent and possibly administrative Compositions), perform a disjoint merge in the target Version container by:</p>
<div class="ulist">
<ul>
<li>
<p>creating a new trunk version in the target Version container;</p>
</li>
</ul>
</div>
</li>
<li>
<p>if there is no logical equivalent, do the following:</p>
<div class="ulist">
<ul>
<li>
<p>create a new target Version container;</p>
</li>
<li>
<p>create its first trunk Version;</p>
</li>
</ul>
</div>
</li>
<li>
<p>in both cases, continue as follows:</p>
<div class="ulist">
<ul>
<li>
<p>set the <code><em>data</em></code> in the new trunk Version to be a copy of the data from the most recent trunk Version from the source container;</p>
</li>
<li>
<p>set <code><em>other_input_version_uids</em></code> to include the uid of the source Version being merged (this uid will contain the uid of the Version container being logically deleted);</p>
</li>
<li>
<p>for any branches on the most recent trunk Version in the source container, create corresponding branches on the newly created trunk Version in the target, include the corresponding content and set the <code><em>other_input_version_uids</em></code> in the target in the same way as above;</p>
</li>
<li>
<p>add a new trunk Version to the source container, with the <code><em>data</em></code> set to Void, and <code><em>lifecycle_state</em></code> set to deleted.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>As for copying and merging, an important consequence of this procedure is that the resulting record (i.e. the target of the merge procedure) continues to correctly represent previous states of the repository, regardless of how many recent merges have occurred.</p>
</div>
</div>
<div class="sect2">
<h3 id="_moving_version_containers"><a class="anchor" href="#_moving_version_containers"></a>4.4. Moving Version Containers</h3>
<div class="paragraph">
<p>It will not be uncommon that whole Versioned objects need to be moved to another system, e.g. due to a move of a complete patient record (due to the patient moving), or re-organisation of EHR data centres. The semantics of a move are different from those of copying: with a move, there is no longer a source instance after the operation; the destination instance becomes the primary instance.</p>
</div>
<div class="paragraph">
<p>When the move is effected, the identifier of the system in which the <code>Versioned_object</code> now exists will usually be different from what it was before. As a consequence, subsequent versions of the content created in a moved version container will now have the <code><em>uid.creating_system_id</em></code> set to the id of the new system. This creates another variation on the version lineage, one in which the <code><em>uid.creating_system_id</em></code> value can change in the trunk line, as shown in below.</p>
</div>
<div id="moving_version_container" class="imageblock text-center text-center">
<div class="content">
<img src="change_control/diagrams/moving_version_container.png" alt="moving version container" width="50%">
</div>
<div class="title">Figure 11. Moving a version container</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="Hntynka2004"></a>Hntynka, P., &amp; Plil, F. (2004). Distributed Versioning Model for MOF. In <em>Proceedings of WISICT 2004, Cancun, Mexico</em>, ACM international conference proceedings. Computer Science Press, Trinity College Dublin Ireland.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-10-26 22:53:42 -0600
</div>
</div>
</body>
</html>